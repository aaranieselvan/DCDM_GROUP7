---
title: "datacleaning"
output: html_document
date: "2024-12-18"
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

##Install tidyverse package
The tidyverse package contains .....
```{r}
library(tidyverse)
```

#Define the correct field order from the IMPC_SOP.csv file
```{r}
sop_file <- "~/Desktop/DCDM_Group7/originals/IMPC_SOP.csv" #path to IMPC_SOP
sop_data <- read.csv(sop_file, header = TRUE) 
```

# Extract and clean the correct field names (standardized to lowercase)
```{r}
# Makesure the fields column data is all in lowercase 
correct_fields <- tolower(trimws(sop_data[[1]]))  # Lowercase and remove extra spaces
```

# Set the path to the folder containing all 140k files
```{r}
data_path <- "~/Desktop/DCDM_Group7/originals/7/"
```

# List all files in the folder
```{r}
file_list <- list.files(path = data_path, pattern = "\\.csv$", full.names = TRUE)
```

# Creata an empty list to store data
```{r}
combined_data <- list()
```

#Create a loop to process each file 
```{r}
for (file in file_list) {
  # Read the file
  data <- read.csv(file, header = FALSE, col.names = c("field", "value"))
  
  # Clean up the 'field' names: lowercase and remove spaces
  data$field <- tolower(trimws(data$field))
  
  # Transpose the 'value' column so that fields become column names
  reshaped_data <- t(data$value) %>%
    as.data.frame() %>%
    setNames(data$field)
  
  # Ensure all columns are in the correct order
  # Add missing columns with NA
  missing_fields <- setdiff(correct_fields, names(reshaped_data))  # Find fields that are missing
  
  
  # Reorder columns to match the correct field order
  final_data <- reshaped_data %>%
    select(all_of(correct_fields))
  
  # Append to the list
  combined_data[[length(combined_data) + 1]] <- final_data
}
```

# Combine all data frames into one
```{r}
final_combined_data <- bind_rows(combined_data)
```

# Write the combined data to a single CSV file
```{r}
write.csv(final_combined_data, "combined_output.csv", row.names = FALSE)
```

